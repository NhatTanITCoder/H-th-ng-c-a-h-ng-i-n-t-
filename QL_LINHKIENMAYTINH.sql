CREATE DATABASE DB_LINHKIENMAYTINH
ON  PRIMARY 
( 
	NAME = N'DB_LINHKIENMAYTINH',
	FILENAME = N'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\FILE\DB_LINHKIENMAYTINH.mdf',
	SIZE = 3136KB, 
	MAXSIZE = UNLIMITED, 
	FILEGROWTH = 1024KB
)
LOG ON 
( 
	NAME = N'DB_LINHKIENMAYTINH_log', 
	FILENAME = N'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\FILE\DB_LINHKIENMAYTINH_log.ldf' , 
	SIZE = 784KB , 
	MAXSIZE = 100MB, 
	FILEGROWTH = 10%
)
GO

USE DB_LINHKIENMAYTINH
GO

/***---------------------- Tạo bảng chức năng: Table [dbo].[CHUCNANG] ----------------------***/
CREATE TABLE CHUCNANG
(
	MACHUCNANG VARCHAR(50) NOT NULL,
	TENCHUCNANG NVARCHAR(50),
	SOTHUTU INT,
	CONSTRAINT PK_CHUCNANG PRIMARY KEY(MACHUCNANG)
)
GO

/***---------------------- Tạo bảng người dùng: Table [dbo].[NGUOIDUNG] ----------------------***/
CREATE TABLE NGUOIDUNG
(
	NGUOIDUNG VARCHAR(50) NOT NULL,
	MATKHAU VARCHAR(50),
	TENNGUOIDUNG NVARCHAR(100),
	CONSTRAINT PK_NGUOIDUNG PRIMARY KEY(NGUOIDUNG)
)
GO

/***---------------------- Tạo bảng phân quyền: Table [dbo].[PHANQUYEN] ----------------------***/
CREATE TABLE PHANQUYEN
(
	MACHUCNANG VARCHAR(50) NOT NULL,
	NGUOIDUNG VARCHAR(50) NOT NULL,
	XEM BIT,
	THEM BIT, 
	XOA BIT,
	SUA BIT,
	CONSTRAINT PK_PHANQUYEN PRIMARY KEY
	(
		MACHUCNANG,
		NGUOIDUNG
	)
)
GO

/***---------------------- Tạo bảng khách hàng: Table [dbo].[KHACHHANG] ----------------------***/
CREATE TABLE KHACHHANG
(
	MAKH VARCHAR(10) NOT NULL,
	HOTEN NVARCHAR(50),
	GIOITINH NVARCHAR(5),
	DIACHI NVARCHAR(100),
	SDT VARCHAR(15), --KO TRÙNG
	LOAIKHACHHANG NVARCHAR(50),
	EMAIL VARCHAR(100),
	CONSTRAINT PK_KHACHHANG PRIMARY KEY(MAKH)
)
GO

/***---------------------- Tạo bảng nhân viên: Table [dbo].[NHANVIEN] -------------------------***/
CREATE TABLE NHANVIEN
(
	MANV VARCHAR(10) NOT NULL,
	TENNV NVARCHAR(50),
	NGAYSINH DATE,
	GIOITINH NVARCHAR(5),
	NGAYVAOLAM DATE,
	DIACHI NVARCHAR(100),
	SDT VARCHAR(15), --KO TRÙNG
	EMAIL VARCHAR(100),
	CHUCVU NVARCHAR(50),
	NGUOIDUNG VARCHAR(50),
	LUONG FLOAT,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MANV)
)
GO

/***---------------------- Tạo bảng nhà cung cấp: Table [dbo].[NHACUNGCAP] ----------------------***/
CREATE TABLE NHACUNGCAP
(
	MANCC VARCHAR(10) NOT NULL,
	TENNCC NVARCHAR(100),
	DIACHI NVARCHAR(100),
	SDT VARCHAR(15),
	NGUOILIENHE NVARCHAR(50),
	SDTNGUOILIENHE VARCHAR(15),
	CONSTRAINT PK_NHACUNGCAP PRIMARY KEY(MANCC)
)
GO

/***---------------------- Tạo bảng thiết bị: Table [dbo].[THIETBI] ----------------------***/
CREATE TABLE THIETBI
(
	MATHIETBI VARCHAR(10) NOT NULL,
	TENTHIETBI NVARCHAR(100),
	GHICHU NVARCHAR(1000),
	HINHMINHHOA NVARCHAR(100),
	LOAI NVARCHAR(25),
	MANCC VARCHAR(10),
	DVT NVARCHAR(10),
	DONGIA FLOAT,
	CONSTRAINT PK_THIETBI PRIMARY KEY(MATHIETBI)
)
GO

/***---------------------- Tạo bảng giảm giá: Table [dbo].[GIAMGIA] ----------------------***/
CREATE TABLE GIAMGIA
(
	MAGIAMGIA NVARCHAR(20) NOT NULL,
	PHANTRAMGIAMGIA FLOAT CHECK(PHANTRAMGIAMGIA >=0 AND PHANTRAMGIAMGIA <=100),
	SOTIENGIAMMAX FLOAT CHECK(SOTIENGIAMMAX >=0),
	CONSTRAINT PK_GIAMGIA PRIMARY KEY(MAGIAMGIA)
)
GO

/***---------------------- Tạo bảng thiết bị: Table [dbo].[TONKHO] ----------------------***/
CREATE TABLE TONKHO
(
	MATHIETBI VARCHAR(10) NOT NULL,
	TENTHIETBI NVARCHAR(100),
	SOLUONG INT NOT NULL CHECK(SOLUONG >=0),
	CONSTRAINT PK_TONKHO PRIMARY KEY
	(
		MATHIETBI,
		SOLUONG
	)
)
GO

/***---------------------- Tạo bảng hóa đơn: Table [dbo].[HOADON] ----------------------***/
CREATE TABLE HOADON
(
	MAHOADON VARCHAR(10) NOT NULL,
	MAKH VARCHAR(10) NULL,
	NGAYTAO DATE NULL,
	TENNGUOINHAN NVARCHAR(50) NULL,
	DIACHIGIAOHANG NVARCHAR(100) NULL,
	TIENGOC FLOAT,
	SOTIENGIAM FLOAT NULL,
	TONGTHANHTIEN FLOAT NULL,
	MANV VARCHAR(10) NOT NULL,
	CONSTRAINT PK_HOADON PRIMARY KEY(MAHOADON)
)
GO

/***---------------------- Tạo bảng hóa đơn: Table [dbo].[CHITIETHD] ----------------------***/
CREATE TABLE CHITIETHD
(
	MAHOADON VARCHAR(10) NOT NULL,
	MATHIETBI VARCHAR(10) NOT NULL,
	SOLUONG INT,
	DONGIA FLOAT CHECK(DONGIA>=0),
	TIENGOC FLOAT,
	MAGIAMGIA NVARCHAR(20) NOT NULL,
	PHANTRAMGIAMGIA FLOAT,
	TIENGIAMGIA FLOAT,
	TONGTHANHTIEN FLOAT,
	CONSTRAINT PK_CTHD PRIMARY KEY
	(
		MAHOADON,
		MATHIETBI
	)
)
GO

/***---------------------- Tạo bảng hóa đơn nhập hàng: Table [dbo].[HOADONNHAP] ----------------------***/
CREATE TABLE HOADONNHAP
(
	MAHDN VARCHAR(10) NOT NULL,
	MANV VARCHAR(10) NOT NULL,
	MANCC VARCHAR(10) NOT NULL,
	NGAYNHAP DATE,
	TONGTIEN FLOAT,
	CONSTRAINT PK_HOADONNHAP PRIMARY KEY(MAHDN)
)
GO

/***---------------------- Tạo bảng chi tiết hóa đơn nhập hàng: Table [dbo].[CHITIETNHAPHANG] ----------------------***/
CREATE TABLE CHITIETNHAPHANG
(
	MAHDN VARCHAR(10) NOT NULL,
	MATHIETBI VARCHAR(10) NOT NULL,
	TENTHIETBI NVARCHAR(100),
	SOLUONG INT CHECK(SOLUONG>=0),
	GIANHAP FLOAT,
	DONVITINH NVARCHAR(30),
	THANHTIEN FLOAT,
	CONSTRAINT PK_CTNH PRIMARY KEY
	(
		MAHDN,
		MATHIETBI
	)
)
GO

/*-------------------------------- RÀNG BUỘC TOÀN VẸN Ở CÁC BẢNG -----------------------------*/
--1. Ở dbo.KHACHHANG thì EMAIL không được phép trùng nhau
ALTER TABLE KHACHHANG ADD CONSTRAINT UN_EMAIL_KH UNIQUE(EMAIL);
GO
--2. Ở dbo.KHACHHANG thì số kí tự SDT <= 11
ALTER TABLE KHACHHANG ADD CONSTRAINT C_SDT_KH CHECK(LEN(SDT)<=11)
GO
--3. Ở dbo.NHANVIEN thì EMAIL không được phép trùng nhau
ALTER TABLE NHANVIEN ADD CONSTRAINT UN_EMAIL_NV UNIQUE(EMAIL);
GO
--4. Ở dbo.NHANVIEN thì số kí tự SDT <= 11
ALTER TABLE NHANVIEN ADD CONSTRAINT C_SDT_NV CHECK(LEN(SDT)<=11)
GO
--5. Ở dbo.NHANVIEN thì chức vụ nếu không nhập thì mặc định là 'Nhân viên'
ALTER TABLE NHANVIEN ADD CONSTRAINT DF_CHUCVU DEFAULT 'Nhân viên' FOR CHUCVU
GO
--6. Ở dbo.NHACUNGCAP thì số kí tự SDT <=11
ALTER TABLE NHACUNGCAP ADD CONSTRAINT C_SDT_NCC CHECK(LEN(SDT)<=11)
GO
--7. Ở dbo.NHACUNGCAP thì số kí tự SDTNGUOILIENHE <=11
ALTER TABLE NHACUNGCAP ADD CONSTRAINT C_SDT_NLH CHECK(LEN(SDTNGUOILIENHE)<=11)
GO
--8. Ở dbo.GIAMGIA nếu không nhập thì mặc định phần trăm giảm giá là 0
ALTER TABLE GIAMGIA ADD CONSTRAINT DF_PTGG  DEFAULT ((0)) FOR PHANTRAMGIAMGIA
GO
--9. Ở dbo.GIAMGIA nếu không nhập thì mặc định số tiền giảm là 0
ALTER TABLE GIAMGIA ADD CONSTRAINT DF_GIAMGIA  DEFAULT ((0)) FOR SOTIENGIAMMAX
GO
--10. Ở dbo.THIETBI thì DONGIA > 0
ALTER TABLE THIETBI ADD CONSTRAINT C_DONGIA CHECK(DONGIA>=0)
GO

/*-------------------------------- RÀNG BUỘC KHÓA NGOẠI GIỮA CÁC TABLE -----------------------------*/
--1. Khóa ngoại NGUOIDUNG từ bảng PHANQUYEN tham chiếu đến bảng NGUOIDUNG
ALTER TABLE PHANQUYEN  WITH CHECK ADD  CONSTRAINT [FK__PHANQUYEN__NGUOIDUNG] FOREIGN KEY(NGUOIDUNG)
REFERENCES NGUOIDUNG (NGUOIDUNG)
GO
--2. Khóa ngoại MACHUCNANG từ bảng PHANQUYEN tham chiếu đến bảng CHUCNANG
ALTER TABLE PHANQUYEN WITH CHECK ADD CONSTRAINT [FK_PHANQUYEN_CHUCNANG] FOREIGN KEY(MACHUCNANG)
REFERENCES CHUCNANG (MACHUCNANG)
GO
--3. Khóa ngoại NGUOIDUNG từ bảng NHANVIEN tham chiếu đến bảng NGUOIDUNG
ALTER TABLE NHANVIEN  WITH CHECK ADD  CONSTRAINT [FK__NHANVIEN__NGUOIDUNG] FOREIGN KEY(NGUOIDUNG)
REFERENCES NGUOIDUNG (NGUOIDUNG)
GO
--4. Khóa ngoại MANCC từ bảng THIETBI tham chiếu đến bảng NHACUNGCAP
ALTER TABLE THIETBI  WITH CHECK ADD  CONSTRAINT [FK__THIETBI__NCC] FOREIGN KEY(MANCC)
REFERENCES NHACUNGCAP (MANCC)
GO
--5. Khóa ngoại MATHIETBI từ bảng TONKHO tham chiếu đến bảng THIETBI
ALTER TABLE TONKHO  WITH CHECK ADD  CONSTRAINT [FK__TONKHO__THIETBI] FOREIGN KEY(MATHIETBI)
REFERENCES THIETBI (MATHIETBI)
GO
--6. Khóa ngoại MANV tư bảng HOADON tham chiếu đến bảng NHANVIEN
ALTER TABLE HOADON  WITH CHECK ADD  CONSTRAINT [FK__HOADON__NHANVIEN] FOREIGN KEY(MANV)
REFERENCES NHANVIEN (MANV)
GO
--7. Khóa ngoại MAKH từ bảng HOADON tham chiếu đến bảng KHACHHANG
ALTER TABLE HOADON  WITH CHECK ADD  CONSTRAINT [FK__HOADON__KHACHHANG] FOREIGN KEY(MAKH)
REFERENCES KHACHHANG (MAKH)
GO
--8. Khóa ngoại MAHOADON từ bảng CHITIETHD tham chiếu đến bảng HOADON
ALTER TABLE CHITIETHD  WITH CHECK ADD  CONSTRAINT [FK__CTHD__HOADON] FOREIGN KEY(MAHOADON)
REFERENCES HOADON (MAHOADON)
GO
--9. Khóa ngoại MAGIAMGIA từ bảng CHITIETHD tham chiếu đến bảng GIAMGIA
ALTER TABLE CHITIETHD WITH CHECK ADD  CONSTRAINT [FK__CHITIETHD__GIAMGIA] FOREIGN KEY(MAGIAMGIA)
REFERENCES GIAMGIA (MAGIAMGIA)
GO
--10. Khóa ngoại MATHIETBI từ bảng CHITIETHD tham chiếu đến bảng THIETBI
ALTER TABLE CHITIETHD WITH CHECK ADD  CONSTRAINT [FK__CTHD__THIETBI] FOREIGN KEY(MATHIETBI)
REFERENCES THIETBI (MATHIETBI)
GO
--11. Khóa ngoại MANCC từ bảng HOADONNHAP tham chiếu đến bảng NHACUNGCAP
ALTER TABLE HOADONNHAP WITH CHECK ADD  CONSTRAINT [FK__HDN__NCC] FOREIGN KEY(MANCC)
REFERENCES NHACUNGCAP (MANCC)
GO
--12. Khóa ngoại MANCC từ bảng HOADONNHAP tham chiếu đến bảng NHACUNGCAP
ALTER TABLE HOADONNHAP WITH CHECK ADD  CONSTRAINT [FK__HDN__MANV] FOREIGN KEY(MANV)
REFERENCES NHANVIEN(MANV)
GO
--13. Khóa ngoại MAHDN từ bảng CHITIETNHAPHANG tham chiếu đến bảng HOADONNHAP
ALTER TABLE CHITIETNHAPHANG WITH CHECK ADD  CONSTRAINT [FK__CTNH__HDN] FOREIGN KEY(MAHDN)
REFERENCES HOADONNHAP (MAHDN)
GO
--14. Khóa ngoại MATHIETBI từ bảng CHITIETNHAPHANG tham chiếu đến bảng THIETBI
ALTER TABLE CHITIETNHAPHANG WITH CHECK ADD  CONSTRAINT [FK__CTNH__THIETBI] FOREIGN KEY(MATHIETBI)
REFERENCES THIETBI (MATHIETBI)
GO

/*-------------------------------- INSERT INTO DỮ LIỆU VÀO CÁC TABLE -----------------------------*/
--Thêm dữ liệu vào bảng CHUCNANG(MACHUCNANG, TENCHUCNANG, SOTHUTU)
	INSERT INTO CHUCNANG VALUES('FormNhanVien',N'QUẢN LÝ NHÂN VIÊN',1)
	INSERT INTO CHUCNANG VALUES('FormKhachHang', N'QUẢN LÝ KHÁCH HÀNG',2)
	INSERT INTO CHUCNANG VALUES('FormSanPham', N'QUẢN LÝ SẢN PHẨM',3)
	INSERT INTO CHUCNANG VALUES('FormHoaDon', N'QUẢN LÝ HÓA ĐƠN',4)
	INSERT INTO CHUCNANG VALUES('FormHoaDonNhap', N'QUẢN LÝ HÓA ĐƠN NHÂP',5)
GO
--Thêm dữ liệu vào bảng NGUOIDUNG(NGUOIDUNG, MATKHAU, TENNGUOIDUNG)
	INSERT INTO NGUOIDUNG VALUES('admin', '123', N'Huỳnh Nhật Tân')
	INSERT INTO NGUOIDUNG VALUES('tam', '123@', N'Trần Văn Tân')
	INSERT INTO NGUOIDUNG VALUES('duy', '123@', N'Nguyễn Lê Hoàng Duy')
	INSERT INTO NGUOIDUNG VALUES('duong', '1234', N'Nguyễn Thị Thùy Dương')
	INSERT INTO NGUOIDUNG VALUES('thinh', 'thinh', N'Lê Văn Thịnh')
	INSERT INTO NGUOIDUNG VALUES('hailndd', 'hai123@', N'Nguyễn Văn Hải')
GO
--Thêm dữ liệu vào bảng PHANQUYEN(MACHUCNANG, NGUOIDUNG, XEM, THEM, XOA, SUA)
	INSERT INTO PHANQUYEN VALUES('FormNhanVien', 'admin', 1, 1, 1, 1)
	INSERT INTO PHANQUYEN VALUES('FormKhachHang', 'duy',1, 1, 1, 1)
	INSERT INTO PHANQUYEN VALUES('FormSanPham', 'tam', 0, 0, 0, 0)
	INSERT INTO PHANQUYEN VALUES('FormHoaDon', 'duong', 1, 0, 0, 0)
	INSERT INTO PHANQUYEN VALUES('FormHoaDonNhap', 'hailndd',1,1,1,1)
GO
--Thêm dữ liệu vào bảng KHACHHANG(MAKH, HOTEN, GIOITINH, DIACHI, SDT, LOAIKHACHHANG, EMAIL)
	INSERT INTO KHACHHANG VALUES('KH001',N'Nguyễn Lê Hoàng Duy', N'Nam', N'TP. HCM', '0354403544', N'KH VIP', 'hoangduy@gmail.com')
	INSERT INTO KHACHHANG VALUES('KH002',N'Huỳnh Nhật Tân', N'Nam', N'TP. HCM', '0354539397', N'KH VIP', 'nhattan@gmail.com')
	INSERT INTO KHACHHANG VALUES('KH003',N'Trần Minh Tân',N'Nam', N'TP. HCM', '035459875', N'KH THUONG', 'Minhtan@gmail.com')
	INSERT INTO KHACHHANG VALUES('KH004',N'Đặng Thị Hiền', N'Nữ', N'TP. HCM', '0355834758', N'KH THUONG', 'Xuanbac@gmail.com')
	INSERT INTO KHACHHANG VALUES('KH005',N'Lê Viết Tường', N'Nam', N'TP. HCM', '0354895754', N'KH THUONG', 'Tuonghufi@gmail.com')
GO
--Thêm dữ liệu vào bảng NHANVIEN(MANV, TENNV, NGAYSINH, GIOITINH, NGAYVAOLAM, DIACHI, SDT, EMAIL, CHUCNANG, NGUOIDUNG, LUONG)
    INSERT INTO NHANVIEN VALUES('NV001',N'Lê Nguyễn Đại Đức Tâm', '2000/8/10', N'Nam', '2021/3/10', N'TP. HCM', '0354403433', 'ductam@gmail.com', N'Quản lý', 'tam', 5800000)
	INSERT INTO NHANVIEN VALUES('NV002',N'Nguyễn Thị Thùy Dương', '2000/8/10', N'Nữ', '2021/3/10', N'TP. HCM', '0358479238', 'thuyduong@gmail.com', N'Thu ngân', 'duong', 5800000)
	INSERT INTO NHANVIEN VALUES('NV003',N'Nguyễn Văn Tài', '2000/8/10', N'Nam', '2021/3/10', N'TP. HCM', '0358734999', 'Vantaig@gmail.com', N'Bán hàng', 'hailndd', 5700000)
	INSERT INTO NHANVIEN VALUES('NV004',N'Lê Nguyễn Văn Việt', '2000/8/10', N'Nam', '2021/3/10', N'TP. HCM', '0359837459', 'Vanviet@gmail.com', N'Bán hàng', 'tam',6100000)
	INSERT INTO NHANVIEN VALUES('NV005',N'Lê Văn Cường', '2000/8/10', N'Nam', '2021/3/10', N'TP. HCM', '0359845970', 'Vancuong@gmail.com', N'Bán hàng', 'duong', 6000000)
	INSERT INTO NHANVIEN VALUES('NV006',N'Nguyễn Văn Hải', '2000/8/10', N'Nam', '2021/3/10', N'TP. HCM', '0394230994', 'Vanhai@gmail.com', N'Bán hàng', 'hailndd', 6500000)
GO
--Thêm dữ liệu vào bảng NHACUNGCAP(MANCC, TENNCC, DIACHI, SDT, NGUOILIENHE, SDTNGUOILIENHE)
	INSERT INTO NHACUNGCAP VALUES('NCC001',N'Công ty xuất nhập khẩu TT', N'TP. HCM', '0354303433', N'Nguyễn Hoàng Khang', '0345532564')
	INSERT INTO NHACUNGCAP VALUES('NCC002',N'Công ty xuất nhập khẩu TD', N'TP. HCM', '0359284927', N'Nguyễn Văn Của', '0386363298')
	INSERT INTO NHACUNGCAP VALUES('NCC003',N'Công ty xuất nhập khẩu TS', N'TP. HN', '0354536756', N'Lê Văn Nhân', '0345453466')
	INSERT INTO NHACUNGCAP VALUES('NCC004',N'Công ty xuất nhập khẩu TTN', N'TP. HN', '0303470394', N'Lê Hữu Nghĩa', '0394875401')
	INSERT INTO NHACUNGCAP VALUES('NCC005',N'Công ty xuất nhập khẩu TNS', N'TP. DN', '0354803923', N'Nguyễn Văn Toàn', '0320394830')
	INSERT INTO NHACUNGCAP VALUES('NCC006',N'Công ty xuất nhập khẩu QN', N'TP. DN', '0354297832', N'Nguyễn Công Phượng', '0342398429')
GO
--Thêm dữ liệu vào bảng THIETBI(MATHIETBI, TENTHIETBI, GHICHU, HINHMINHHOA, LOAI, MANCC, DVT, DONGIA)
	INSERT INTO THIETBI VALUES('CPU001',N'CPU Intel core i3 4160', N'Tốc độ 3,60 GHz; Nhân/Luồng:2/4; Socket: LGA 1100; TDP: 54W', N'CPU_Intel_corei3_4160.JPG', N'CPU', 'NCC001', N'Cái', 3200000)
	INSERT INTO THIETBI VALUES('CPU002',N'CPU Intel Core i5 - 11400 6C/12T', N'Tốc độ: 4GHz; Nhân/Luồng: 8/16; Socket: LGA 1200; TDP: 65W', N'CPU_Intel_corei5_11400_6C12T.jpg', N'CPU', 'NCC001', N'Cái', 3200000)
	INSERT INTO THIETBI VALUES('CPU003',N'CPU AMD Ryzen 7 5700G', N'Tốc độ: 3.8GHz/ 4.6GHz; Nhân/Luồng: 8/16; Socket: AM4; TDP: 65W', N'CPU_AMD_Ryzen7_5700G.jpg', N'CPU', 'NCC001', N'Cái', 3300000)
	-------------Màn hình-----------------
	INSERT INTO THIETBI VALUES('MH001',N'Màn Hình HP P204v', N'Màn hình có kích thước 19.5 inch,độ phân giải 1600x900', N'ManHinh_HP_P204v.jpg', N'Màn Hình', 'NCC001', N'Cái', 2500000)
	INSERT INTO THIETBI VALUES('MH002',N'Màn Hình Samsung 34 LS34J550WQEXXV LED', N' độ phân giải:3440x1440 từ màn hình SJ55W ', N'ManHinh_Samsung _34_LS34J550WQEXXV_LED.jpg', N'Màn Hình', 'NCC001', N'Cái', 4000000)
	INSERT INTO THIETBI VALUES('MH003',N'Màn Hình Máy Tính Cong Full Viền 24inch 75Hz',  N'Tỉ lệ 16:9 Độ sáng:250cd/m2 Độ tương phản 2000000:1 Tần số quét 75Hz',N'ManHinh_Cong_Full _Vien_24inch _75Hz-1.jpg', N'Màn Hình', 'NCC001', N'Cái', 4100000)
	-------------Chuột-----------------
	INSERT INTO THIETBI VALUES('CH001',N'Chuột Không Dây Logitech M590 Slient', N'áp dụng công nghệ này cho phép người dùng copy-paste trên 2 máy tính khác nhau', N'ChuotKD_Logitech_M590_Slient.jpg', N'Chuột Không Dây', 'NCC002', N'Cái', 150000)
	INSERT INTO THIETBI VALUES('CH002',N'Chuột Có Dây Fuhlen L102 1000DPI', N'Sử dụng công nghệ cảm biến quang hiện đại với độ phân giải 1000 DPI với 3 nút bấm cơ bản ', N'ChuotCD_Fuhlen_L102_1000DPI.jpg', N'Chuột Có Dây', 'NCC002', N'Cái', 180000)
	INSERT INTO THIETBI VALUES('CH003',N'Chuột Game Có Dây A867 HXSJ', N'HXJS Cảm biến: quang học DPI: DPI lên đến 6400DPI Hiệu ứng marquee RGB (7 màu) ', N'ChuotGameCD_A867_HXSJ.jpg', N'Chuột Có Dây', 'NCC002', N'Cái', 2000000)
	-------------Bàn phím-----------------
	INSERT INTO THIETBI VALUES('BP001',N'Bàn Phím Có Dây Dell KB216', N'trên phím có 3 tiếng trung việt anh, thiết kế mỏng đẹp', N'BanPhimCD_Dell_KB216.jpg', N'Bàn Phím Có Dây', 'NCC003', N'Cái', 350000)
	INSERT INTO THIETBI VALUES('BP002',N'Bàn phím máy tính Meetion K202', N'Meetion. ModelK202/AK100,USB 2.0 & 3.0', N'BanPhimMT_Meetion_K202.jpg', N'Bàn Phím Máy Tính', 'NCC003', N'Cái', 3600000)
	INSERT INTO THIETBI VALUES('BP003',N'Bàn phím máy tinh Rosi RS K111', N'Có dây,USB:2.0', N'BanPhimMT_Rosi_RS_K111.jpg', N'Bàn Phím Máy Tính', 'NCC003', N'Cái', 3700000)
	-------------Card màn hình-----------------
	INSERT INTO THIETBI VALUES('CA001',N'Card màn hình GIGABYTE GV-N1060AORUS-6GD', N'Chip:NVIDIA GeForce GTX 1060, Bộ Nhớ 6GB GDDR5 ( 192-bit )', N'Card_GIGABYTE_GV-N1060AORUS-6GD.jpg', N'Card màn hình', 'NCC004', N'Cái', 6000000)
	INSERT INTO THIETBI VALUES('CA002',N'Card Màn Hình ASUS GTX 750Ti 2G/ DDR5/ 128BIT', N'Chip :NVIDIA GeForce GTX 750 Ti, Bộ Nhớ 2GB - DDR5 - 128Bit', N'Card_ASUS_GTX_750Ti.jpg', N'Card màn hình', 'NCC004', N'Cái', 6100000)
	INSERT INTO THIETBI VALUES('CA003',N'Card màn hình Zotac GT630', N'CPU GeForce® GT 630,RAM 128-bit', N'Card_Zotac_GT630.jpg', N'Card màn hình', 'NCC004', N'Cái', 6200000)
	-------------Ram-----------------
	INSERT INTO THIETBI VALUES('RA001',N'Ram 4G DDR3 Bus 1600', N'Dung lượng:4GB,Loại RAMDDR3Bus1333/1600MHz', N'Ram4G_DDR3_Bus_1600.jpg', N'Ram', 'NCC004', N'Cái', 5000000)
	INSERT INTO THIETBI VALUES('RA002',N'Ram sever RAM HP 4GB PC3-10600', N'Dung lượng:4GB,Băng Thông:PC3 10600', N'Ram_HP_4GB_PC3-10600.jpg', N'Ram', 'NCC004', N'Cái', 5100000)
	INSERT INTO THIETBI VALUES('RA003',N'RAM Laptop Kingston 16GB 2666MHz DDR4', N'Dung lượng: 1x 16GB,Xung nhịp: 2666 MHz', N'RAM_Kingston_16GB.jpg', N'Ram', 'NCC004', N'Cái', 5200000)
	-------------Ổ cứng-----------------
	INSERT INTO THIETBI VALUES('OC001',N'SSD Gigabyte 120Gb', N'Dung lượng: 120GB,Giao tiếp: SATA 6.0Gb/s', N'SSD_GB_120.jpg', N'SSD', 'NCC005', N'Cái', 41000000)
	INSERT INTO THIETBI VALUES('OC002',N'SSD Samsung 980 1TB M.2 NVMe PCIe Gen 3.0 x4 MZ-V8V1T0BW', N'Dung lượng: 1 TB,Tốc độ đọc/ghi ( tối đa ): 3500 MB/s/ 3000 MB/s', N'SSD_Samsung_980_1TB.jpg', N'SSD', 'NCC005', N'Cái', 42000000)
	INSERT INTO THIETBI VALUES('OC003',N' SSD Samsung 980 PRO 2TB PCIe 4.0 NVMe Gen4.0 x4', N'Dung lượng: 2TB ,Tốc độ đọc/ghi: 7,000/5,100 MB/s', N'SSD_980_PRO_2TB.jpg', N'SSD', 'NCC005', N'Cái', 43000000)
	-------------Main-----------------
	INSERT INTO THIETBI VALUES('MB001',N'Main Gigabyte H81M DS2 Renew', N'CPU:Hỗ trợ cho bộ xử lý Intel® Core ™ i7 / Bộ xử lý Intel® Core ™ i5, Bộ nhớ trong: DDR3 1600/1333 MHz, 2 x 1.5V hỗ trợ tối đa 16GB', N'Main_Gigabyt_H81M_DS2.jpg', N'Main', 'NCC006', N'Cái', 6100000)
	INSERT INTO THIETBI VALUES('MB002',N'Bo Mạch Chủ Gigabyte B365M-D2V', N'PCIe Gen3 x4 M.2, Smart Fan 5, Anti-Sulfur Resistors, CEC 2019 ready', N'Mainboar_GIGABYTE_B365M-D2V.jpg', N'Bo Mạch Chủ', 'NCC006', N'Cái', 12000000)
GO
--Thêm dữ liệu vào bảng GIAMGIA(MAGIAMGIA, PHANTRAMGIAMGIA, SOTIENGIAMMAX)
	INSERT INTO GIAMGIA VALUES(N'Không giảm', 0, 0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 2%',  0.02,  0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 3%', 0.03, 0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 4%', 0.04, 0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 5%', 0.05, 0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 6%', 0.06, 0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 7%', 0.07, 0)
	INSERT INTO GIAMGIA VALUES(N'Giảm 8%', 0.08, 0)
GO
--Thêm dữ liệu vào bảng TONKHO(MATHIETBI, TENTHIETBI, SOLUONG)
	INSERT INTO TONKHO VALUES('CPU001',N'CPU Intel core i3 4160', 10)
	INSERT INTO TONKHO VALUES('MH001',N'Màn Hình HP P204v', 12)
	INSERT INTO TONKHO VALUES('MH002',N'Màn Hình Samsung 34" LS34J550WQEXXV LED', 15)
	INSERT INTO TONKHO VALUES('CH001',N'Chuột Không Dây Logitech M590 Slient', 17)
	INSERT INTO TONKHO VALUES('CH002',N'Chuột Có Dây Fuhlen L102 1000DPI', 18)
	INSERT INTO TONKHO VALUES('CH003',N'Chuột Game Có Dây A867 HXSJ', 20)
	INSERT INTO TONKHO VALUES('BP001',N'Bàn Phím Có Dây Dell KB216', 8)
	INSERT INTO TONKHO VALUES('CA001',N'Card màn hình GIGABYTE GV-N1060AORUS-6GD', 22)
	INSERT INTO TONKHO VALUES('RA001',N'Ram 4G DDR3 Bus 1600', 5)
	INSERT INTO TONKHO VALUES('OC001',N'SSD Gigabyte 120Gb', 9)
	INSERT INTO TONKHO VALUES('MB001',N'Main Gigabyte H81M DS2 Renew', 2)
	INSERT INTO TONKHO VALUES('MB002',N'Bo Mạch Chủ Gigabyte B365M-D2V', 6)
GO
--Thêm dữ liệu vào bảng HOADON(MAHOADON, MAKH, NGAYTAO, TENNGUOINHAN, DIACHIGIAOHANG, TIENGOC, SOTIENGIAM, TONGTHANHTIEN, MANV)
	INSERT INTO HOADON VALUES('HD001', 'KH001', '2021/8/1', N'Nguyễn Lê Hoàng Duy', N'140 Lê Trọng Tấn', NULL, NULL, NULL, 'NV001')
	INSERT INTO HOADON VALUES('HD002', 'KH002', '2021/8/2', N'Huỳnh Nhật Tân', N'182 Lê Trọng Tấn', NULL, NULL, NULL, 'NV002')
	INSERT INTO HOADON VALUES('HD003', 'KH002', '2021/8/3', N'Huỳnh Nhật Tân', N'182 Lê Trọng Tấn', NULL, NULL, NULL, 'NV003')
	INSERT INTO HOADON VALUES('HD004', 'KH003', '2021/8/4', N'Trần Minh Tân', N'162 Chế Lan Viên',  NULL, NULL, NULL, 'NV004')
	INSERT INTO HOADON VALUES('HD005', 'KH004', '2021/8/5', N'Lê Xuân Bắc', N'40 Ba Vân', NULL, NULL, NULL, 'NV005')
	INSERT INTO HOADON VALUES('HD006', 'KH005', '2021/8/10', N'Lê Viết Tường', N'15 Trường Chinh', NULL, NULL, NULL, 'NV006')
GO
--Thêm dữ liệu vào bảng CHITIETHD(MAHOADON, MATHIETBI, SOLUONG, DONGIA, TIENGOC, MAGIAMGIA, PHANTRAMGIAMGIA, TIENGIAMGIA, TONGTHANHTIEN)
	INSERT INTO CHITIETHD VALUES('HD001', 'CPU001', 1, 3200000, 3200000, N'Không giảm', 0, 0, 3200000)
	INSERT INTO CHITIETHD VALUES('HD001', 'BP001', 2, 350000, 700000, N'Giảm 2%', 0.02, 14000, 686000)
	INSERT INTO CHITIETHD VALUES('HD002', 'CH001', 1, 150000, 150000, N'Không giảm', 0, 0, 150000)
	INSERT INTO CHITIETHD VALUES('HD002', 'CH002', 1, 180000, 180000, N'Không giảm', 0, 0, 180000)
	INSERT INTO CHITIETHD VALUES('HD003', 'MB001', 1, 6100000, 6100000, N'Giảm 2%', 0.02, 122000, 5978000)
	INSERT INTO CHITIETHD VALUES('HD004', 'MH001', 2, 61000000, 12200000, N'Giảm 2%', 0.02, 244000, 11956000)
GO

	
--Thêm dữ liệu vào bảng HOADONNHAP(MAHDN, MANCC, NGAYNHAP, TONGTIEN)
	INSERT INTO HOADONNHAP VALUES('HDN001', 'NV001', 'NCC001', '2021/08/01', 0)
	INSERT INTO HOADONNHAP VALUES('HDN002', 'NV001', 'NCC002', '2021/08/02', 0)
	INSERT INTO HOADONNHAP VALUES('HDN003', 'NV001', 'NCC003', '2021/08/05', 0)
	INSERT INTO HOADONNHAP VALUES('HDN004', 'NV002', 'NCC004', '2021/08/10', 0)
	INSERT INTO HOADONNHAP VALUES('HDN005', 'NV003', 'NCC005', '2021/08/20', 0)
	INSERT INTO HOADONNHAP VALUES('HDN006', 'NV003', 'NCC006', '2021/08/23', 0)
GO
--Thêm dữ liệu vào bảng CHITIETNHAPHANG(MAHDN, MATHIETBI, TENTHIETBI, SOLUONG, GIANHAP, DONVITINH, THANHTIEN)
	INSERT INTO CHITIETNHAPHANG VALUES('HDN001', 'CPU001', 'CPU Intel core i3 4160', 10, 3000000, N'Cái', 30000000)
	INSERT INTO CHITIETNHAPHANG VALUES('HDN001', 'CPU002', 'Màn Hình HP P204v', 20, 2000000, N'Cái', NULL)
	INSERT INTO CHITIETNHAPHANG VALUES('HDN002', 'CH003', 'Màn Hình Samsung 34" LS34J550WQEXXV LED', 20, 3000000, N'Cái', NULL)
	INSERT INTO CHITIETNHAPHANG VALUES('HDN002', 'BP001', 'Chuột Không Dây Logitech M590 Slient', 20, 1000000, N'Cái', NULL)
	INSERT INTO CHITIETNHAPHANG VALUES('HDN003', 'RA001', 'Chuột Có Dây Fuhlen L102 1000DPI', 20, 1200000, N'Cái', NULL)
GO

/*-------------------------------- CÁC CÂU LỆNH TRUY VẤN SQL -----------------------------*/
--CÁC CÂU LỆNH SELECT
---1. Cho biết tổng số lượng nhân viên làm việc được từ 2 năm trở lên
	SELECT COUNT(*) as N'Số lượng làm việc trên 2 năm'
	FROM NHANVIEN
	WHERE (YEAR(NGAYVAOLAM)- YEAR(GETDATE())) > 2
	GO

---2. Cho biết những nhân viên có lương lớn nhất
	SELECT * 
	FROM NHANVIEN
	WHERE LUONG >= ALL(SELECT LUONG FROM NHANVIEN)
	GO

---3. Cho biết những nhân viên có lương ít nhất
	SELECT * 
	FROM NHANVIEN
	WHERE LUONG <= ALL(SELECT LUONG FROM NHANVIEN)
	GO

---4. Cho biết những nhân viên sinh năm 1995
	SELECT * 
	FROM NHANVIEN
	WHERE (YEAR(NGAYSINH)) = 2000
	GO

---5. Xuất MANV, TENNV của những nhân viên có họ bắt đầu bằng chữ 'N'
	SELECT MANV, TENNV
	FROM NHANVIEN
	WHERE TENNV LIKE 'N%'
	GO

---6. Tìm MANV, TENNV, NGAYSINH, DIACHI của những nhân viên có tên bắt đầu bằng chữ 'T'
	SELECT MANV, TENNV, NGAYSINH, DIACHI
	FROM NHANVIEN
	WHERE TENNV LIKE 'Tài'
	GO

---7. Xuất MANV, TENNV của những nhân viên có họ không bắt đầu bằng chữ 'N'
	SELECT MANV, TENNV
	FROM NHANVIEN
	WHERE TENNV NOT LIKE 'N%'
	GO

---8. Hiển thị danh sách MANV, TENNV, GIOITINH, NGAYSINH, 'TUỔI' của những nhân viên có tuổi từ 18 - 30
	SELECT MANV, TENNV, GIOITINH, NGAYSINH, (YEAR(GETDATE())-YEAR(NGAYSINH)) AS N'Tuổi'
	FROM NHANVIEN
	WHERE (YEAR(GETDATE())-YEAR(NGAYSINH)) BETWEEN 18 AND 30
	GO

---9. Tìm theo MANV, TENNV, 'MAX HÓA ĐƠN' nhân viên nào lập nhiều hóa đơn bán nhất
---10. Những nhân viên nào trong cửa hàng có cùng ngày sinh với nhau
	SELECT NV1.TENNV AS 'NHÂN VIÊN CÓ NGÀY SINH TRÙNG NHAU', NV1.NGAYSINH
	FROM NHANVIEN NV1, NHANVIEN NV2
	WHERE NV1.NGAYSINH=NV2.NGAYSINH 
		  AND NV1.MANV <>  NV2.MANV
	GO

---11. Tìm những nhân viên nào có chức vụ là 'Quản lý'
	SELECT MANV, TENNV
	FROM NHANVIEN
	WHERE CHUCVU = N'Quản lý'
	GO

---12. Cho biết khách hàng nào mua hàng với hóa đơn có số tiền cao nhất
	SELECT HD.MAKH, HOTEN AS 'KHÁCH HÀNG MUA NHIỀU NHẤT', MAHOADON, NGAYTAO, TONGTHANHTIEN
	FROM HOADON HD, KHACHHANG KH
	WHERE HD.MAKH = KH.MAKH AND TONGTHANHTIEN > = ALL(SELECT TONGTHANHTIEN FROM HOADON)
	GO

---13. Những thiết bị máy tính nào thuộc nhà cung cấp N'Công ty xuất nhập khẩu TT'
	SELECT MATHIETBI, TENTHIETBI, TB.MANCC, TENNCC
	FROM THIETBI TB, NHACUNGCAP NCC
	WHERE TB.MANCC = NCC.MANCC AND TENNCC = N'Công ty xuất nhập khẩu TT'
	GO

---14. Những mặt hàng nào có số lượng tồn kho lớn hơn 10 và nhỏ hơn 100
	SELECT TB.MATHIETBI, TB.TENTHIETBI, SOLUONG
	FROM THIETBI TB LEFT JOIN TONKHO TK
	ON TB.MATHIETBI = TK.MATHIETBI
	WHERE SOLUONG BETWEEN 10 AND 100
	GO
---15. Hóa đơn nào được đặt mua ít nhất?
	SELECT HD.MAHOADON AS 'MÃ HÓA ĐƠN', TENTHIETBI AS 'TÊN THIẾT BỊ', SOLUONG AS 'SỐ LƯƠNG MUA ÍT NHẤT'
	FROM HOADON HD, CHITIETHD CTHD, THIETBI TB
	WHERE HD.MAHOADON=CTHD.MAHOADON 
		  AND CTHD.MATHIETBI=TB.MATHIETBI 
		  AND SOLUONG <= ALL(SELECT SOLUONG FROM CHITIETHD)
	GO

---16. Những sản phẩm nào chưa từng được khách hàng đặt mua?
	SELECT MATHIETBI AS N'MÃ THIẾT BỊ', TENTHIETBI AS N'TÊN SẢN PHẨM CHƯA TỪNG ĐƯỢC MUA'
	FROM THIETBI TB
	WHERE NOT EXISTS (SELECT MATHIETBI FROM CHITIETHD CTHD WHERE TB.MATHIETBI=CTHD.MATHIETBI)
	GO

---17. Trong năm 5/2021, những mặt hàng nào chỉ được đặt mua đúng một lần.
	SELECT TB.MATHIETBI, TENTHIETBI
	FROM CHITIETHD CTHD, HOADON HD, THIETBI TB
	WHERE CTHD.MAHOADON=HD.MAHOADON AND CTHD.MATHIETBI=TB.MATHIETBI AND YEAR(NGAYTAO) = 2021 AND MONTH(NGAYTAO) = 8
	GROUP BY TB.MATHIETBI, TENTHIETBI
	HAVING COUNT(CTHD.MATHIETBI) = 1
	GO

---18. Xuất danh sách (MATHIETBI, TENTHIETBI) của nhà cung cấp có "Công ty xuất nhập khẩu TT" sản xuất nhưng không bán được
	SELECT MATHIETBI, TENTHIETBI as N'Thiết bị không bán được'
	FROM THIETBI TB, NHACUNGCAP NCC
	WHERE TB.MANCC = NCC.MANCC AND TENNCC = N'Công ty xuất nhập khẩu TT'
		  AND MATHIETBI NOT IN(SELECT MATHIETBI FROM CHITIETHD)
	GO

--CÁC CÂU LỆNH UPDATE
---1. Cập nhật TIENGOC của từng mặt hàng ở CHITIETHD
	UPDATE CHITIETHD
	SET TIENGOC = SOLUONG * DONGIA
	GO

---2. Cập nhật Tổng tiền các mặt hàng mà khách hàng đã mua của hóa đơn HD001 ở CHITIETHD lên TONGTIEN ở bảng HOADON
	UPDATE CHITIETHD
	SET TONGTHANHTIEN = (SOLUONG * DONGIA)-(PHANTRAMGIAMGIA*SOLUONG*DONGIA)
	GO

---3. Cập nhật Tiền của từng mặt hàng ở CHITIETHD lên HOADON theo MAHD='HD001'
	UPDATE HOADON
	SET TONGTHANHTIEN = (SELECT SUM(TONGTHANHTIEN) 
						 FROM CHITIETHD 
						 WHERE MAHOADON ='HD001')
	FROM HOADON HD, CHITIETHD CTHD
	WHERE HD.MAHOADON = CTHD.MAHOADON 
		  AND HD.MAHOADON = 'HD001'
	GO

---4. Cập nhật Tiền của từng mặt hàng ở CHITIETHD lên HOADON theo MAHD='HD001'
	UPDATE HOADONNHAP
	SET TONGTIEN = (SELECT SUM(THANHTIEN) 
						 FROM CHITIETNHAPHANG
						 WHERE MAHDN ='HDN001')
	FROM HOADONNHAP HDN, CHITIETNHAPHANG CTNH
	WHERE HDN.MAHDN = CTNH.MAHDN
		  AND HDN.MAHDN = 'HD001'
	GO

--CÁC CÂU LỆNH DELETE
/*-------------------------------- TẠO BẢNG ẢO VIEW -----------------------------*/
---1. Tạo view có tên TT_HOADON cho biết thông tin các hóa đơn: Thông tin báo gồm: MAHD, TENKH, TENNV, NGAYTAO, DIACHIGIAOHANG, TONGTHANHTIEN
	CREATE VIEW TT_HOADON
	AS 
	SELECT MAHOADON, HOTEN, TENNV, NGAYTAO, DIACHIGIAOHANG, TONGTHANHTIEN
	FROM HOADON HD, KHACHHANG KH, NHANVIEN NV
	WHERE HD.MAKH = KH.MAKH AND HD.MANV = NV.MANV
	GO
	--Thực thi view TT_HOADON
	SELECT * FROM TT_HOADON
	GO

---2. Tạo view có tên Tong_HOADON cho biết thông tin và tổng tiền các HOADON đã bán
	CREATE VIEW Tong_HOADON
	AS
		SELECT HD.MAHOADON, MAKH, MANV, NGAYTAO,
			   DIACHIGIAOHANG, SUM(SOLUONG*DONGIA-SOLUONG*DONGIA*PHANTRAMGIAMGIA) AS 'TONG'
		FROM HOADON HD, CHITIETHD CTHD
		WHERE HD.MAHOADON=CTHD.MAHOADON
		GROUP BY  HD.MAHOADON, MAKH, MANV, NGAYTAO, DIACHIGIAOHANG													  
	GO
	--Thực thi view Tong_HOADON
	SELECT * FROM Tong_HOADON
	GO

---3. Tạo view có tên TT_HOADONNHAP cho biết thông tin các hóa đơn nhập: Thông tin bao gồm: MAHDN, MANCC, TENNCC, NGAYNHAP, TONGTIEN
	CREATE VIEW TT_HOADONNHAP
	AS
	SELECT MAHDN, HDN.MANCC, TENNCC, NGAYNHAP, TONGTIEN
	FROM HOADONNHAP HDN, NHACUNGCAP NCC
	WHERE HDN.MANCC = NCC.MANCC
	GO
	--Thực thi view TT_HOADONNHAP
	SELECT * FROM TT_HOADONNHAP
	GO

/*-------------------------------- TẠO THỦ TỤC THƯỜNG TRÚ (STORE PROCEDURE) -----------------------------*/
---1. Viết thủ tục cập nhật TIENGOC trên CHITIETHD theo MAHD, trong đó TIENGOC = DONGIA * SOLUONG
	CREATE PROC TINH_TIENGOC_CTHD
	(@MAHD VARCHAR(10))
	AS 
	BEGIN
		UPDATE CHITIETHD
		SET TIENGOC = DONGIA * SOLUONG
		WHERE @MAHD = MAHOADON
	END
	GO
	---Thực thi TINH_TIENGOC_CTHD
	EXEC TINH_TIENGOC_CTHD 'HD001'
	GO
	select * from chitiethd
---2. Viết thủ tục cập nhật TIENGIAMGIA trên CHITIETHD theo MAHD, trong đó TIENGIAMGIA = (DONGIA*SOLUONG*PHANTRAMGIAM)
	CREATE PROC TINH_TIENGIAMGIA_CTHD
	(@MAHD VARCHAR(10))
	AS
	BEGIN
		UPDATE CHITIETHD
		SET TIENGIAMGIA =  (DONGIA * SOLUONG * PHANTRAMGIAMGIA)
		WHERE @MAHD = MAHOADON
	END
	GO
	---Thực thi TINH_TIENGIAMGIA_CTHD
	EXEC TINH_TIENGIAMGIA_CTHD 'HD001'
	GO

---3. Viết thủ tục cập nhật TONGTHANHTIEN trên CHITIETHD theo MAHD, trong đó TONGTHANHTIEN = TIENGOC - TIENGIAMGIA
	CREATE PROC TINH_TONGTIEN_CTHD
	(@MAHD VARCHAR(10))
	AS 
	BEGIN
		UPDATE CHITIETHD
		SET TONGTHANHTIEN = TIENGOC - TIENGIAMGIA
		WHERE @MAHD = MAHOADON
	END
	GO
	---Thực thi TINH_TONGTIEN_CTHD
	EXEC TINH_TONGTIEN_CTHD 'HD001'
	GO

---4. Viết thủ tục cập nhật TONGTHANHTIEN trên HOADON từ các mặt hàng trên CHITIETHD theo MAHD
	CREATE PROC TINH_TONGTIEN_HD
	(@MAHD VARCHAR(10))
	AS 
	BEGIN
		UPDATE HOADON
		SET TONGTHANHTIEN = (SELECT SUM(TONGTHANHTIEN) 
							 FROM CHITIETHD
							 WHERE @MAHD = MAHOADON)
		FROM HOADON HD, CHITIETHD CTHD
		WHERE HD.MAHOADON = CTHD.MAHOADON
		AND @MAHD = HD.MAHOADON
	END
	GO
	---Thực thi TINH_TONGTIEN_HD
	EXEC TINH_TONGTIEN_HD 'HD001'
	GO
---5. Viết thủ tục cập nhật TIENGOC trên HOADON từ các mặt hàng trên CHITIETHD theo MAHD
	CREATE PROC TINH_TIENGOC_HD
	(@MAHD VARCHAR(10))
	AS 
	BEGIN
		UPDATE HOADON
		SET TIENGOC = (SELECT SUM(TIENGOC) 
							 FROM CHITIETHD
							 WHERE @MAHD = MAHOADON)
		FROM HOADON HD, CHITIETHD CTHD
		WHERE HD.MAHOADON = CTHD.MAHOADON
		AND @MAHD = HD.MAHOADON
	END
	GO
	---Thực thi TINH_TONGTIEN_HD
	EXEC TINH_TIENGOC_HD 'HD001'
	GO
---6. Viết thủ tục cập nhật SOTIENGIAM trên HOADON từ các mặt hàng trên CHITIETHD theo MAHD
	CREATE PROC TINH_TIENGIAMGIA_HD
	(@MAHD VARCHAR(10))
	AS 
	BEGIN
		UPDATE HOADON
		SET SOTIENGIAM = (SELECT SUM(TIENGIAMGIA) 
							 FROM CHITIETHD
							 WHERE @MAHD = MAHOADON)
		FROM HOADON HD, CHITIETHD CTHD
		WHERE HD.MAHOADON = CTHD.MAHOADON
		AND @MAHD = HD.MAHOADON
	END
	GO
	---Thực thi TINH_TONGTIEN_HD
	EXEC TINH_TIENGIAMGIA_HD 'HD001'
	GO

---7. Viết thủ tục cập nhật TONGTIEN trên HOADONNHAP từ các mặt hàng trên CHITIETNHAPHANG theo MAHDN
	CREATE PROC TINH_TONGTIEN_HDN
	(@MAHDN VARCHAR(10))
	AS 
	BEGIN
		UPDATE HOADONNHAP
		SET TONGTIEN = (SELECT SUM(THANHTIEN) 
							 FROM CHITIETNHAPHANG
							 WHERE @MAHDN = MAHDN)
		FROM HOADONNHAP HDN, CHITIETNHAPHANG CTN
		WHERE HDN.MAHDN = CTN.MAHDN
		AND @MAHDN = HDN.MAHDN
	END
	GO
	---Thực thi TINH_TONGTIEN_HD
	EXEC TINH_TONGTIEN_HDN 'HDN001'
	GO

---8. Viết thủ tục cho biết số lượng nhân viên theo từng Chức vụ
	CREATE PROC NHANVIEN_CHUCVU
	AS
	BEGIN
		SELECT CHUCVU, COUNT(*) AS N'SỐ LƯƠNG THEO CHỨC VỤ'
		FROM NHANVIEN
		GROUP BY CHUCVU
	END
	GO
	---Thực thi TINH_TONGTIEN_HD
	EXEC NHANVIEN_CHUCVU
	GO

---9. Viết thủ tục truyền vào MATHIETBI sẽ trả về các MAHD, TENKH đã mua, nếu không có hóa đơn nào thì trả về "CHƯA CÓ HÓA ĐƠN NÀO"
	CREATE PROC PROC_KT_HOADON
	(@MATB VARCHAR(10) OUTPUT)
	AS
	BEGIN
		IF EXISTS(SELECT HD.MAHOADON, HOTEN FROM THIETBI TB, HOADON HD, KHACHHANG KH, CHITIETHD CTHD
					WHERE TB.MATHIETBI = CTHD.MATHIETBI AND CTHD.MAHOADON = HD.MAHOADON AND HD.MAKH = KH.MAKH AND TB.MATHIETBI = @MATB)
			SELECT HD.MAHOADON, HOTEN
			FROM THIETBI TB, HOADON HD, KHACHHANG KH, CHITIETHD CTHD
			WHERE TB.MATHIETBI = CTHD.MATHIETBI 
				  AND CTHD.MAHOADON = HD.MAHOADON 
				  AND HD.MAKH = KH.MAKH 
				  AND TB.MATHIETBI = @MATB
		ELSE 
			PRINT @MATB + N' CHƯA CÓ HÓA ĐƠN NÀO ĐẶT MUA'
	END
	GO
	--Thực thi PROC_KT_HOADON
	EXEC PROC_KT_HOADON 'CPU002'
	GO

---10. Viết thủ tục Update bảng Nhân viên bao gồm(MANV, TENNV, NGAYSINH, GIOITINH)
	CREATE PROC PROC_UpdateNhanVien(@MANV VARCHAR(10), @TENNV NVARCHAR(50), @NGAYSINH DATE, @GIOITINH NVARCHAR(5), @DIACHI NVARCHAR(50))
	AS
	BEGIN
		IF EXISTS(SELECT MANV FROM NHANVIEN WHERE MANV=@MANV)
		BEGIN
			UPDATE NHANVIEN
			SET MANV = @MANV,
				TENNV = @TENNV,
				NGAYSINH = @NGAYSINH,
				GIOITINH = @GIOITINH,
				DIACHI = @DIACHI
			WHERE MANV = @MANV
			PRINT N'Cập nhật thành công nhân viên có mã: ' + @MANV 
			RETURN 1
		END
		ELSE
			PRINT N'Không tồn tại nhân viên có mã: '+@MANV
			RETURN 0
	END
	GO
	--Thực thi PROC_UpdateNhanVien
	EXEC PROC_UpdateNhanVien 'NV007', N'Nguyễn Văn A', '1999/08/01', N'Nam', N'Bến Tre'
	GO

---11. Viết thủ tục thống kê tổng số lượng hàng bán được của một mã thiết bị bất kì
	CREATE PROC PROC_ThongKe_SLBan
	(@MATB VARCHAR(10))
	AS
	BEGIN
		SELECT TB.MATHIETBI, TENTHIETBI, SUM(CTHD.SOLUONG) AS N'Tổng số lượng đã bán'
		FROM THIETBI TB LEFT JOIN CHITIETHD CTHD
		ON TB.MATHIETBI = CTHD.MATHIETBI
		WHERE TB.MATHIETBI=@MATB
		GROUP BY TB.MATHIETBI, TENTHIETBI
	END
	GO
	--Thực thi PROC_ThongKe_SLBan
	EXEC PROC_ThongKe_SLBan 'CPU001'
	GO

--- 12. Viết thủ tục cho biết tên nhà sản xuất và số loại linh kiện đã bán của từng nhà sản xuất, sắp xếp tăng dần số lượng.
	CREATE PROC PROC_NCC_SLBan
	AS
	BEGIN
		SELECT ncc.MANCC, TENNCC, COUNT(*) AS N'Số lượng loại linh kiện đã bán'
		FROM NHACUNGCAP ncc, THIETBI tb, CHITIETHD cthd
		WHERE ncc.MANCC = tb.MANCC AND cthd.MATHIETBI = tb.MATHIETBI
		GROUP BY ncc.MANCC, TENNCC
		ORDER BY COUNT(*)
	END
	GO
	--Thực thi PROC_NCC_SLBan
	EXEC PROC_NCC_SLBan;
	GO
----------Proceduce Thêm
--- 10. Thêm nhân viên
	CREATE PROCEDURE THEM_NHANVIEN
	(@MANV VARCHAR(10), @TENNV NVARCHAR(50), @NGAYSINH DATE, @GIOITINH NVARCHAR(5),
	 @NGAYVL DATE, @DIACHI NVARCHAR(100), @SDT VARCHAR(15), @EMAIL VARCHAR(100), @CHUCVU NVARCHAR(50),
	 @NGUOIDUNG VARCHAR(50), @LUONG FLOAT)
	AS
	BEGIN
		INSERT INTO [dbo].[NHANVIEN]
		([MANV],[TENNV],[NGAYSINH],[GIOITINH],[NGAYVAOLAM],[DIACHI],[SDT],[EMAIL],[CHUCVU],[NGUOIDUNG],[LUONG])
		 VALUES(@MANV, @TENNV, @NGAYSINH, @GIOITINH,@NGAYVL, @DIACHI, @SDT, @EMAIL, @CHUCVU, @NGUOIDUNG, @LUONG)
	END
	GO
	
	EXEC THEM_NHANVIEN 'NV007', N'Huỳnh Nhật Tân', '1996/08/01', N'Nam', '2021/09/01', N'Bến Tre', '01654479948', 'nhattan120@gmail.com', N'Quản lý', 'tamlndd', 10000000
	GO

--- 11. Thêm khách hàng
	CREATE PROCEDURE THEM_KHACHHANG
	(@MAKH VARCHAR(10), @HOTEN NVARCHAR(50), @GIOITINH NVARCHAR(5), @DIACHI NVARCHAR(100),
	 @SDT VARCHAR(15), @LOAIKH NVARCHAR(50), @EMAIL VARCHAR(100))
	AS
	BEGIN
		INSERT INTO [dbo].[KHACHHANG]
		([MAKH],[HOTEN],[GIOITINH],[DIACHI],[SDT],[LOAIKHACHHANG],[EMAIL])
		 VALUES(@MAKH, @HOTEN, @GIOITINH, @DIACHI, @SDT, @LOAIKH, @EMAIL)
	END
	GO
--- 12. Thêm nhà cung cấp
	CREATE PROCEDURE THEM_NHACUNGCAP
	(@MANCC VARCHAR(10), @TENNCC NVARCHAR(100), @DIACHI NVARCHAR(100), @SDT VARCHAR(15), @NGUOILIENHE NVARCHAR(50), @SDTNLH VARCHAR(15))
	AS
	BEGIN
		INSERT INTO [dbo].[NHACUNGCAP]
		([MANCC],[TENNCC],[DIACHI],[SDT],[NGUOILIENHE],[SDTNGUOILIENHE])
		 VALUES(@MANCC, @TENNCC, @DIACHI, @SDT, @NGUOILIENHE, @SDTNLH)
	END
	GO
--- 13. Thêm thiết bị
	CREATE PROCEDURE THEM_THIETBI
	(@MATB VARCHAR(10), @TENTB NVARCHAR(100), @GHICHU NVARCHAR(1000), @HINH NVARCHAR(100), @LOAI NVARCHAR(25), @MANCC VARCHAR(10),
	 @DVT NVARCHAR(10), @DONGIA FLOAT)
	AS
	BEGIN
		INSERT INTO [dbo].[THIETBI]
		([MATHIETBI],[TENTHIETBI],[GHICHU],[HINHMINHHOA],[LOAI],[MANCC],[DVT],[DONGIA])
		 VALUES(@MATB, @TENTB, @GHICHU, @HINH, @LOAI, @MANCC, @DVT, @DONGIA)
	END
	GO
--- 14. Thêm tồn kho
	CREATE PROCEDURE THEM_TONKHO
	(@MATB VARCHAR(10), @TENTHIETBI NVARCHAR(100), @SOLUONG INT)
	AS
	BEGIN
		INSERT INTO [dbo].[TONKHO]
		([MATHIETBI],[TENTHIETBI],[SOLUONG])
		 VALUES(@MATB, @TENTHIETBI, @SOLUONG)
	END
	GO
--- 15. Thêm giảm giá
	CREATE PROCEDURE THEM_GIAMGIA
	(@MAGG NVARCHAR(20), @PTGIAM FLOAT, @SOTIENGIAM FLOAT)
	AS
	BEGIN
		INSERT INTO [dbo].[GIAMGIA]
		([MAGIAMGIA],[PHANTRAMGIAMGIA],[SOTIENGIAMMAX])
		 VALUES(@MAGG, @PTGIAM, @SOTIENGIAM)
	END
	GO
--- 16. Thêm hóa đơn bán
	CREATE PROCEDURE THEM_HOADON
	(@MAHD VARCHAR(10), @MAKH VARCHAR(10), @NGAYTAO DATE, @TENNGUOINHAN NVARCHAR(50), @DIACHIGIAOHANG NVARCHAR(100),
	 @TIENGOC FLOAT, @SOTIENGIAM FLOAT, @TONGTHANHTIEN FLOAT, @MANV VARCHAR(10))
	AS
	BEGIN
		INSERT INTO [dbo].[HOADON]
		([MAHOADON],[MAKH],[NGAYTAO],[TENNGUOINHAN],[DIACHIGIAOHANG],[TIENGOC],[SOTIENGIAM],[TONGTHANHTIEN],[MANV])
		 VALUES(@MAHD, @MAKH, @NGAYTAO, @TENNGUOINHAN, @DIACHIGIAOHANG, @TIENGOC, @SOTIENGIAM, @TONGTHANHTIEN, @MANV)
	END
	GO
--- 17. Thêm chi tiết hóa đơn bán
	CREATE PROCEDURE THEM_CHITIETHD
	(@MAHD VARCHAR(10), @MATB VARCHAR(10), @SOLUONG INT, @DONGIA FLOAT, @TIENGOC FLOAT, @MAGG NVARCHAR(20), @PTGG FLOAT, @TIENGG FLOAT, @THANHTIEN FLOAT)
	AS
	BEGIN
		INSERT INTO [dbo].[CHITIETHD]
		([MAHOADON],[MATHIETBI],[SOLUONG],[DONGIA],[TIENGOC],[MAGIAMGIA],[PHANTRAMGIAMGIA],[TIENGIAMGIA],[TONGTHANHTIEN])
		 VALUES(@MAHD, @MATB, @SOLUONG, @DONGIA, @TIENGOC, @MAGG, @PTGG, @TIENGG, @THANHTIEN)
	END
	GO
--- 18. Thêm hóa đơn nhập
	CREATE PROCEDURE THEM_HOADONNHAP
	(@MAHDN VARCHAR(10), @MANV VARCHAR(10), @MANCC VARCHAR(10), @NGAYNHAP DATE, @TONGTIEN FLOAT)
	AS
	BEGIN
		INSERT INTO [dbo].[HOADONNHAP]
		([MAHDN],[MANV], [MANCC], [NGAYNHAP], [TONGTIEN])
		 VALUES(@MAHDN, @MANV, @MANCC, @NGAYNHAP, @TONGTIEN)
	END
	GO
--- 19. Thêm chi tiết hóa đơn nhập
	CREATE PROCEDURE THEM_CHITIETNHAP
	(@MAHDN VARCHAR(10), @MATB VARCHAR(10), @TENTB NVARCHAR(100), @SOLUONG INT, @GIANHAP FLOAT, @DVT NVARCHAR(30), @THANHTIEN FLOAT)
	AS
	BEGIN
		INSERT INTO [dbo].[CHITIETNHAPHANG]
		([MAHDN],[MATHIETBI],[TENTHIETBI],[SOLUONG],[GIANHAP],[DONVITINH],[THANHTIEN])
		 VALUES(@MAHDN, @MATB, @TENTB, @SOLUONG, @GIANHAP, @DVT, @THANHTIEN)
	END
	GO
----------Proceduce Sửa
--- 20. Sửa nhân viên theo MANV
	CREATE PROCEDURE SUA_NHANVIEN
	(@MANV VARCHAR(10), @TENNV NVARCHAR(50), @NGAYSINH DATE, @GIOITINH NVARCHAR(5),
	 @NGAYVL DATE, @DIACHI NVARCHAR(100), @SDT VARCHAR(15), @EMAIL VARCHAR(100), @CHUCVU NVARCHAR(50),
	 @NGUOIDUNG VARCHAR(50), @LUONG FLOAT)
	AS
	BEGIN
		UPDATE [dbo].[NHANVIEN]
		SET  [TENNV] = @TENNV,[NGAYSINH] = @NGAYSINH,[GIOITINH] = @GIOITINH,[NGAYVAOLAM] = @NGAYVL,[DIACHI] = @DIACHI
			,[SDT] = @SDT,[EMAIL] = @EMAIL,[CHUCVU] = @CHUCVU,[NGUOIDUNG] = @NGUOIDUNG,[LUONG] = @LUONG
		WHERE MANV = @MANV
	END
	GO
--- 21. Sửa khách hàng theo MAKH
	CREATE PROCEDURE SUA_KHACHHANG
	(@MAKH VARCHAR(10), @HOTEN NVARCHAR(50), @GIOITINH NVARCHAR(5), @DIACHI NVARCHAR(100),
	 @SDT VARCHAR(15), @LOAIKH NVARCHAR(50), @EMAIL VARCHAR(100))
	AS
	BEGIN
		UPDATE [dbo].[KHACHHANG]
		SET	 [HOTEN] = @HOTEN,[GIOITINH] = @GIOITINH,[DIACHI] = @DIACHI,[SDT] = @SDT,[LOAIKHACHHANG] = @LOAIKH,[EMAIL] = @EMAIL
		WHERE MAKH = @MAKH
	END
	GO
--- 22. Sửa nhà cung cấp theo MANCC
	CREATE PROCEDURE SUA_NHACUNGCAP
	(@MANCC VARCHAR(10), @TENNCC NVARCHAR(100), @DIACHI NVARCHAR(100), @SDT VARCHAR(15), @NGUOILIENHE NVARCHAR(50), @SDTNLH VARCHAR(15))
	AS
	BEGIN
		UPDATE [dbo].[NHACUNGCAP]
		SET  [TENNCC] = @TENNCC,[DIACHI] = @DIACHI,[SDT] = @SDT,[NGUOILIENHE] = @NGUOILIENHE,[SDTNGUOILIENHE] = @SDTNLH
		WHERE MANCC = @MANCC
	END
	GO
--- 23. Sửa thiết bị theo MATHIETBI
	CREATE PROCEDURE SUA_THIETBI
	(@MATB VARCHAR(10), @TENTB NVARCHAR(100), @GHICHU NVARCHAR(1000), @HINH NVARCHAR(100), @LOAI NVARCHAR(25), @MANCC VARCHAR(10),
	 @DVT NVARCHAR(10), @DONGIA FLOAT)
	AS
	BEGIN
		UPDATE [dbo].[THIETBI]
		SET  [TENTHIETBI] = @TENTB,[GHICHU] = @GHICHU,[HINHMINHHOA] = @HINH,[LOAI] = @LOAI,[MANCC] = @MANCC,[DVT] = @DVT,[DONGIA] = @DONGIA
		WHERE MANCC = @MANCC
	END
	GO
--- 24. Sửa tồn kho theo MATHIETBI
	CREATE PROCEDURE SUA_TONKHO
	(@MATB VARCHAR(10), @TENTHIETBI NVARCHAR(100), @SOLUONG INT)
	AS
	BEGIN
		UPDATE [dbo].[TONKHO]
		SET  [TENTHIETBI] = @TENTHIETBI,[SOLUONG] = @SOLUONG WHERE MATHIETBI = @MATB
	END
	GO
--- 25. Sửa giảm giá theo MAGIAMGIA
	CREATE PROCEDURE SUA_GIAMGIA
	(@MAGG NVARCHAR(20), @PTGIAM FLOAT, @SOTIENGIAM FLOAT)
	AS
	BEGIN
		UPDATE [dbo].[GIAMGIA]
		SET [PHANTRAMGIAMGIA] = @PTGIAM ,[SOTIENGIAMMAX] = @SOTIENGIAM
		WHERE MAGIAMGIA = @MAGG
	END
	GO
--- 26. Sửa hóa đơn bán theo MAHOADON
	CREATE PROCEDURE SUA_HOADON
	(@MAHD VARCHAR(10), @MAKH VARCHAR(10), @NGAYTAO DATE, @TENNGUOINHAN NVARCHAR(50), @DIACHIGIAOHANG NVARCHAR(100),
	 @TIENGOC FLOAT, @SOTIENGIAM FLOAT, @TONGTHANHTIEN FLOAT, @MANV VARCHAR(10))
	AS
	BEGIN
		UPDATE [dbo].[HOADON]
		SET  [MAKH] = @MAKH,[NGAYTAO] = @NGAYTAO,[TENNGUOINHAN] = @TENNGUOINHAN,[DIACHIGIAOHANG] = @DIACHIGIAOHANG
		,[TIENGOC] = @TIENGOC,[SOTIENGIAM] = @SOTIENGIAM,[TONGTHANHTIEN] = @TONGTHANHTIEN,[MANV] = @MANV
		WHERE MAHOADON = @MAHD
	END
	GO
--- 28. Sửa chi tiết hóa đơn bán theo MAHOADON, MATHIETBI
	CREATE PROCEDURE SUA_CHITIETHD
	(@MAHD VARCHAR(10), @MATB VARCHAR(10), @SOLUONG INT, @DONGIA FLOAT, @TIENGOC FLOAT, @MAGG NVARCHAR(20), @PTGG FLOAT, @TIENGG FLOAT, @THANHTIEN FLOAT)
	AS
	BEGIN
		UPDATE [dbo].[CHITIETHD]
		SET  [MATHIETBI] = @MATB,[SOLUONG] = @SOLUONG,[DONGIA] = @DONGIA,[TIENGOC] = @TIENGOC,[MAGIAMGIA] = @MAGG
			,[PHANTRAMGIAMGIA] = @PTGG,[TIENGIAMGIA] = @TIENGG,[TONGTHANHTIEN] = @THANHTIEN
		WHERE MAHOADON = @MAHD AND MATHIETBI =@MATB
	END
	GO
--- 29. Sửa hóa đơn nhập theo MAHDN
	CREATE PROCEDURE SUA_HOADONNHAP
	(@MAHDN VARCHAR(10), @MANV VARCHAR(10), @MANCC VARCHAR(10), @NGAYNHAP DATE, @TONGTIEN FLOAT)
	AS
	BEGIN
		UPDATE [dbo].[HOADONNHAP]
		SET  [MANV] = @MANV,[MANCC] = @MANCC,[NGAYNHAP] = @NGAYNHAP,[TONGTIEN] = @TONGTIEN
		WHERE MAHDN = @MAHDN
	END
	GO
--- 30. Sửa chi tiết hóa đơn nhập theo MAHDN, MATHIETBI
	CREATE PROCEDURE SUA_CHITIETNHAP
	(@MAHDN VARCHAR(10), @MATB VARCHAR(10), @TENTB NVARCHAR(100), @SOLUONG INT, @GIANHAP FLOAT, @DVT NVARCHAR(30), @THANHTIEN FLOAT)
	AS
	BEGIN
		UPDATE [dbo].[CHITIETNHAPHANG]
		SET  [MATHIETBI] = @MATB,[TENTHIETBI] = @TENTB,[SOLUONG] = @SOLUONG,[GIANHAP] = @GIANHAP,[DONVITINH] = @DVT,[THANHTIEN] = @THANHTIEN
		WHERE MAHDN =@MAHDN AND MATHIETBI=@MATB
	END
	GO
----------Proceduce xóa
--- 31. Xóa nhân viên theo MANV
	CREATE PROC XOA_NHANVIEN (@MANV VARCHAR(10))
	AS
	BEGIN
		DELETE FROM NHANVIEN 
		WHERE MANV = @MANV
	END
	GO
--- 32. Xóa khách hàng theo MAKH
	CREATE PROC XOA_KHACHHANG (@MAKH VARCHAR(10))
	AS
	BEGIN
		DELETE FROM KHACHHANG 
		WHERE MAKH = @MAKH
	END
	GO
--- 33. Xóa nhà cung cấp theo MANCC
	CREATE PROC XOA_NHACUNGCAP(@MANCC VARCHAR(10))
	AS
	BEGIN
		DELETE FROM NHACUNGCAP
		WHERE MANCC = @MANCC
	END
	GO
--- 34. Xóa thiết bị theo MATHIETBI
	CREATE PROC XOA_THIETBI(@MATB VARCHAR(10))
	AS
	BEGIN
		DELETE FROM THIETBI
		WHERE MATHIETBI = @MATB
	END
	GO
--- 35. Xóa tồn kho theo MATHIETBI
	CREATE PROC XOA_TONKHO(@MATB VARCHAR(10))
	AS
	BEGIN
		DELETE FROM TONKHO
		WHERE MATHIETBI = @MATB
	END
	GO
--- 36. Xóa giảm giá theo MAGIAMGIA
	CREATE PROC XOA_GIAMGIA(@MAGG VARCHAR(10))
	AS
	BEGIN
		DELETE FROM GIAMGIA
		WHERE MAGIAMGIA = @MAGG
	END
	GO
--- 37. Xóa hóa đơn bán theo MAHOADON
	CREATE PROC XOA_HOADON(@MAHD VARCHAR(10))
	AS
	BEGIN
		DELETE FROM HOADON
		WHERE MAHOADON = @MAHD
	END
	GO
--- 38. Xóa chi tiết hóa đơn bán theo MAHOADON, MATHIETBI
	CREATE PROC XOA_CHITIETHD(@MAHD VARCHAR(10), @MATB VARCHAR(10))
	AS
	BEGIN
		DELETE FROM CHITIETHD
		WHERE MAHOADON = @MAHD AND MATHIETBI = @MATB
	END
	GO
--- 39. Xóa hóa đơn nhập theo MAHDN
	CREATE PROC XOA_HOADONHAP(@MAHDN VARCHAR(10))
	AS
	BEGIN
		DELETE FROM HOADONNHAP
		WHERE MAHDN = @MAHDN
	END
	GO
--- 40. Xóa chi tiết hóa đơn nhập theo MAHDN, MATHIETBI
	CREATE PROC XOA_CHITIETNHAP(@MAHDN VARCHAR(10), @MATB VARCHAR(10))
	AS
	BEGIN
		DELETE FROM CHITIETNHAPHANG
		WHERE MAHDN = @MAHDN AND MATHIETBI = @MATB
	END
	GO

/*-------------------------------- TẠO THỦ TỤC HÀM FUNCTION -----------------------------*/
---1. Viết hàm khi truyền vào MANV sẽ trả về họ tên và tên chức vụ của nhân viên đó.
	CREATE FUNCTION FUNC_1_MANV
	(
		@MANV CHAR(10)
	)
	RETURNS @TABLE TABLE(HOTEN NVARCHAR(30), CHUCVU NVARCHAR(30))
	AS
	BEGIN
		INSERT INTO @TABLE
		SELECT TENNV , CHUCVU
		FROM NHANVIEN
		WHERE MANV=@MANV
		RETURN
	END
	GO
	--THỰC THI
	SELECT * FROM  dbo.FUNC_1_MANV('NV001')
	GO

---2. Viết hàm truyền vào tham số Mã thiết bị sẽ trả về tên thiết bị, nhà cung cấp tương ứng.
	CREATE FUNCTION FUNC_2_MATB
	(
		@MATB VARCHAR(10)
	)
	RETURNS @TABLE TABLE(TENTHIETBI NVARCHAR(50), TENNCC NVARCHAR(50))
	AS
	BEGIN
		INSERT INTO @TABLE
		SELECT TENTHIETBI, TENNCC
		FROM THIETBI TB, NHACUNGCAP NCC
		WHERE TB.MANCC = NCC.MANCC
			  AND @MATB = MATHIETBI
		RETURN
	END
	GO
	--THỰC THI
	SELECT * FROM  dbo.FUNC_2_MATB('CPU001')
	GO

---3. Viết hàm kiểm tra quyền XEM ở bảng PHANQUYEN, nếu được xem là 1 ngược lại là 0
	CREATE FUNCTION [dbo].[Funct_ktquyen]
	(
		@MACN VARCHAR(20),
		@MAND VARCHAR(20)
	)
	RETURNS bit
	AS
	BEGIN
		DECLARE @quyen bit
		SELECT @quyen = XEM FROM PHANQUYEN WHERE MACHUCNANG = @MACN AND NGUOIDUNG = @MAND
		-- Return the result of the function
		RETURN @quyen
	END
	GO
	--Thực thi Funct_ktquyen
	SELECT DBO.Funct_ktquyen ('FormNhanVien', 'admin')
	GO

---4. Viết hàm truyền vào mã nhân viên MANV cho biết tuổi của nhân viên đó
	CREATE FUNCTION Funct_TuoiNV
	(@MANV VARCHAR(10))
	RETURNS INT
	AS
	BEGIN
		RETURN (SELECT (YEAR(GETDATE())-YEAR(NGAYSINH)) AS N'Tuổi'
				FROM NHANVIEN WHERE MANV = @MANV) 
	END
	GO
	--Thực thi Funct_TuoiNV
	DECLARE @MANV VARCHAR(10) = (SELECT MANV FROM NHANVIEN WHERE MANV = 'NV001')
	PRINT N'Nhân viên có mã '+ @MANV + ': ' + CONVERT(VARCHAR(10),DBO.Funct_TuoiNV('NV001')) + N'tuổi.'
	GO

---5. Hàm chuyển đổi NgayThang để áp dụng câu 6
	CREATE FUNCTION Funct_getThu
	(@ngay DATETIME)
	RETURNS NVARCHAR(100)
	AS
	BEGIN
		DECLARE @songay int
		SET @songay = DATEPART(WEEKDAY, @ngay)
		DECLARE @thu NVARCHAR(100)
		IF(@songay = 0)
		BEGIN
			SET @thu = N'Thứ 2'
		END
		IF(@songay = 1)
		BEGIN
			SET @thu = N'Thứ 3'
		END
		IF(@songay = 2)
		BEGIN
			SET @thu = N'Thứ 4'
		END
		IF(@songay = 3)
		BEGIN
			SET @thu = N'Thứ 5'
		END
		IF(@songay = 4)
		BEGIN
			SET @thu = N'Thứ 6'
		END
		IF(@songay = 5)
		BEGIN
			SET @thu = N'Thứ 7'
		END
		IF(@songay = 6)
		BEGIN
			SET @thu = N'Chủ nhật'
		END
		RETURN @thu
	END
	GO
---6. Viết hàm truyền vào MAHD trả về bảng gồm: MAHOADON, MAKH, NGAYTAO, TENNGUOINHAN, DIACHIGIAOHANG, NGAYTHU, trong đó
------NGAYTHU (Thứ 2, Thứ 3, Thứ 4,...) theo NGAYTAO
	CREATE FUNCTION Funct_NgayThu_HD
	(@MAHD VARCHAR(10))
	RETURNS TABLE
	AS
		RETURN SELECT MAHOADON, MAKH, NGAYTAO, TENNGUOINHAN, DIACHIGIAOHANG, dbo.Funct_getThu(NGAYTAO) as N'Thuộc thứ'
			   FROM HOADON
	GO
	--Thực thi Funct_NgayThu_HD
	SELECT * FROM Funct_NgayThu_HD('HD001')
	GO
/*-------------------------------- TẠO CÁC RÀNG BUỘC TRIGGER -----------------------------*/
---1. Viết trigger khi thêm mới nhân viên thì LUONG >= 1500000
	CREATE TRIGGER TRIGG_LUONG ON NHANVIEN
	FOR INSERT, UPDATE
	AS
	BEGIN
		IF(SELECT LUONG FROM inserted)<150000
		BEGIN
			PRINT N'LƯƠNG PHẢI LỚN HƠN 1.500.00'
			ROLLBACK TRAN
		END
	END
	GO

---2. Viết trigger kiểm tra giới tính của nhân viên phải là Nam hoặc Nữ
	CREATE TRIGGER TRIGG_KtGioiTinh ON NHANVIEN
	FOR INSERT, UPDATE
	AS
	BEGIN
		IF EXISTS(SELECT GIOITINH FROM inserted WHERE GIOITINH=N'Nam' OR GIOITINH=N'Nữ')
			COMMIT TRAN
		ELSE
			PRINT N'Giới tính phải Nam hoặc Nữ'
			ROLLBACK TRAN
	END
	GO

---3. Viết trigger kiểm tra tuổi của nhân viên không <18 và >60 khi INSERT, UPDATE
	CREATE TRIGGER TRIGG_KTTUOI_NV ON NHANVIEN
	FOR INSERT, UPDATE
	AS
	BEGIN
		DECLARE @AGE INT
		SELECT @AGE = DATEDIFF(YEAR, NGAYSINH, GETDATE())+1 
		FROM inserted
		IF(@AGE < 18 OR @AGE >60)
		BEGIN
			PRINT N'Tuổi nhân viên phải 18<=age<=60'
			ROLLBACK TRAN
		END
	END
	GO

---4. Viết trigger kiểm tra khi Update thì tuổi của Nhân viên phải tuổi mới lớn hơn tuổi cũ
	CREATE TRIGGER TRIGG_KtTuoiMoi ON NHANVIEN
	FOR INSERT, UPDATE 
	AS
	BEGIN
		IF EXISTS(SELECT * FROM inserted I INNER JOIN deleted D
				  ON I.MANV = D.MANV 
				  WHERE (YEAR(GETDATE())-YEAR(D.NGAYSINH)) > (YEAR(GETDATE())-YEAR(I.NGAYSINH)))
		BEGIN
			PRINT N'Tuổi mới không được nhỏ hơn tuổi cũ'
			ROLLBACK TRAN 
		END
	END	
	GO

---5. Viết trigger cho bảng CHITIETHD, khi thêm chi tiết mặt hàng mới thì số lượng hàng hiện có ở bảng TONKHO sẽ giảm đi, nếu số lượng
------hàng hiện có lớn hơn số lượng đặt mua thì cập nhật, ngược lại thì hủy bỏ đặt hàng
	CREATE TRIGGER TRIGG_ThemMatHang ON CHITIETHD
	FOR INSERT
	AS
	BEGIN
		DECLARE @MATB varchar(10)
		DECLARE @SLBAN int
		DECLARE @SLCON int
		SELECT @MATB=MATHIETBI, @SLBAN=SOLUONG
		FROM inserted
		SELECT @SLCON=SOLUONG from TONKHO
		WHERE @MATB=MATHIETBI
		IF (@SLCON>=@SLBAN)
			UPDATE TONKHO SET SOLUONG = @SLCON-@SLBAN
			WHERE @MATB = MATHIETBI
		ELSE
			ROLLBACK TRAN
	END
	GO
	--Thực thi trigger
	INSERT INTO CHITIETHD VALUES('HD005', 'BP001', 1, 3200000, 3200000, 'Không giảm', 0, 0, 3200000)
	GO

---6. Viết trigger cho bảng CHITIETNHAPHANG, khi nhập về mặt hàng mới thì số lượng hàng hiện có ở bảng TONKHO sẽ tăng lên,
------nếu nhập vào số âm thì hủy bỏ nhập hàng
	CREATE TRIGGER TRIGG_NhapHangMoi ON CHITIETNHAPHANG
	FOR INSERT, UPDATE
	AS
	BEGIN
		DECLARE @MATB varchar(10)
		DECLARE @SLTON int
		DECLARE @SLNHAP int
		SELECT @MATB=MATHIETBI, @SLNHAP=SOLUONG
		FROM inserted
		SELECT @SLTON=SOLUONG from TONKHO
		WHERE @MATB=MATHIETBI
		IF (@SLNHAP>=0)
			UPDATE TONKHO SET SOLUONG = @SLTON + @SLNHAP
			WHERE @MATB = MATHIETBI
		ELSE
			ROLLBACK TRAN
	END
	GO
	--Thực thi trigger
	INSERT INTO CHITIETNHAPHANG VALUES('HDN006', 'CPU001', N'CPU Intel core i3 4160',10, 1000000, N'Cái', NULL)
	GO

---7. Viết trigger ở KHACHHANG hiển thị tổng khách hàng nữ hoặc nam khi thêm mới một khách hàng
	CREATE TRIGGER TRIGG_SLKhachTheoGioiTinh ON KHACHHANG
	AFTER INSERT
	AS
	BEGIN
		DECLARE @NAM INT
		DECLARE @NU INT
		SELECT @NAM = COUNT(MAKH) FROM KHACHHANG WHERE GIOITINH = N'Nam'
		SELECT @NU = COUNT(MAKH) FROM KHACHHANG WHERE GIOITINH = N'Nữ'
		PRINT N'Tổng khách hàng nam: '+CONVERT(varchar(10),@NAM)
		PRINT N'Tổng khách hàng nữ: '+CONVERT(varchar(10),@NU)
	END
	GO

---8. Viết trigger ở NHANVIEN hiển thị tổng nhân viên nữ hoặc nam khi thêm mới một nhân viên
	CREATE TRIGGER TRIGG_SLNVTheoGioiTinh ON NHANVIEN
	AFTER INSERT
	AS
	BEGIN
		DECLARE @NAM INT
		DECLARE @NU INT
		SELECT @NAM = COUNT(MANV) FROM NHANVIEN WHERE GIOITINH = N'Nam'
		SELECT @NU = COUNT(MANV) FROM NHANVIEN WHERE GIOITINH = N'Nữ'
		PRINT N'Tổng nhân viên nam: '+CONVERT(varchar(10),@NAM)
		PRINT N'Tổng nhân viên nữ nữ: '+CONVERT(varchar(10),@NU)
	END
	GO

/*-------------------------------- TẠO CON TRỎ (CURSOR) -----------------------------*/
---1. Hiển thị danh sách khách hàng gồm: MAKH, HOTEN, DIACHI, SDT
	DECLARE Cur_DSKhachHang CURSOR
	FOR 
	SELECT MAKH, HOTEN, DIACHI, SDT
	FROM KHACHHANG
	OPEN Cur_DSKhachHang
	DECLARE @MAKH VARCHAR(10), @HOTEN NVARCHAR(50), @DIACHI NVARCHAR(100), @SDT VARCHAR(15)
	FETCH NEXT FROM Cur_DSKhachHang INTO @MAKH, @HOTEN, @DIACHI, @SDT
	DECLARE @RESULT NVARCHAR(MAX)='DANH SÁCH KHÁCH HÀNG: '
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @RESULT = @RESULT + @MAKH +'-'+@HOTEN+'-'+@DIACHI+'-'+@SDT+', '
		FETCH NEXT FROM Cur_DSKhachHang INTO @MAKH, @HOTEN, @DIACHI, @SDT
	END
	PRINT @RESULT
	CLOSE Cur_DSKhachHang
	DEALLOCATE Cur_DSKhachHang
	GO

---2. Viết cursor cập nhật tổng tiền gốc của hóa đơn
	DECLARE Cur_TienGocHD CURSOR
	FOR SELECT MAHOADON, TIENGOC FROM HOADON
	FOR UPDATE OF TIENGOC
	OPEN Cur_TienGocHD
	DECLARE @MAHD VARCHAR(10), @TIENGOC FLOAT
	FETCH NEXT FROM Cur_TienGocHD INTO @MAHD, @TIENGOC
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @TIENGOC = (SELECT SUM(TIENGOC) 
							 FROM CHITIETHD
							 WHERE @MAHD = MAHOADON)
		UPDATE HOADON
		SET TONGTHANHTIEN = @TIENGOC
		WHERE @MAHD = MAHOADON
		FETCH NEXT FROM Cur_TienGocHD INTO @MAHD, @TIENGOC
	END
	CLOSE Cur_TienGocHD
	DEALLOCATE Cur_TienGocHD
	GO

---3. Viết cursor cập nhật tổng tiền của hóa đơn
	DECLARE Cur_TongTienHD CURSOR
	FOR SELECT MAHOADON, TONGTHANHTIEN FROM HOADON
	FOR UPDATE OF TONGTHANHTIEN
	OPEN Cur_TongTienHD
	DECLARE @MAHD VARCHAR(10), @TONGTIEN FLOAT
	FETCH NEXT FROM Cur_TongTienHD INTO @MAHD, @TONGTIEN
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @TONGTIEN = (SELECT SUM(TONGTHANHTIEN) 
							 FROM CHITIETHD
							 WHERE @MAHD = MAHOADON)
		UPDATE HOADON
		SET TONGTHANHTIEN = @TONGTIEN
		WHERE @MAHD = MAHOADON
		FETCH NEXT FROM Cur_TongTienHD INTO @MAHD, @TONGTIEN
	END
	CLOSE Cur_TongTienHD
	DEALLOCATE Cur_TongTienHD
	GO

---4. Viết cursor tính tiền gốc theo từng mặt hàng ở bảng CHITIETHD
	DECLARE Cur_TinhTienGoc_CTHD CURSOR
	FOR SELECT MAHOADON, MATHIETBI, TIENGOC FROM CHITIETHD
	FOR UPDATE OF TIENGOC
	OPEN Cur_TinhTienGoc_CTHD
	DECLARE @MAHD VARCHAR(10), @MATB VARCHAR(10), @TIENGOC FLOAT
	FETCH NEXT FROM Cur_TinhTienGoc_CTHD INTO @MAHD, @MATB, @TIENGOC
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @TIENGOC = (SELECT DONGIA * SOLUONG FROM CHITIETHD WHERE @MAHD = MAHOADON and @MATB = MATHIETBI)
		UPDATE CHITIETHD
		SET TIENGOC = @TIENGOC
		WHERE @MAHD = MAHOADON AND @MATB = MATHIETBI
		FETCH NEXT FROM Cur_TinhTienGoc_CTHD INTO @MAHD, @MATB, @TIENGOC
	END
	CLOSE Cur_TinhTienGoc_CTHD
	DEALLOCATE Cur_TinhTienGoc_CTHD
	GO

---5. Viết cursor tính thành tiền theo từng mặt hàng ở bảng CHITIETNHAPHANG
	DECLARE Cur_TinhThanhTien_CTNH CURSOR
	FOR SELECT MAHDN, MATHIETBI, THANHTIEN FROM CHITIETNHAPHANG
	FOR UPDATE OF THANHTIEN
	OPEN Cur_TinhThanhTien_CTNH
	DECLARE @MAHDN VARCHAR(10), @MATB VARCHAR(10), @THANHTIEN FLOAT
	FETCH NEXT FROM Cur_TinhThanhTien_CTNH INTO @MAHDN, @MATB, @THANHTIEN
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @THANHTIEN = (SELECT SOLUONG * GIANHAP FROM CHITIETNHAPHANG WHERE @MAHDN = MAHDN and @MATB = MATHIETBI)
		UPDATE CHITIETNHAPHANG
		SET THANHTIEN = @THANHTIEN
		WHERE @MAHDN = MAHDN AND @MATB = MATHIETBI
		FETCH NEXT FROM Cur_TinhThanhTien_CTNH INTO @MAHDN, @MATB, @THANHTIEN
	END
	CLOSE Cur_TinhThanhTien_CTNH
	DEALLOCATE Cur_TinhThanhTien_CTNH
	GO

---6. Viết cursor tính tiền giảm giá ở bảng CHITIETHD
	DECLARE Cur_TinhGiamGia_CTHD CURSOR
	FOR SELECT MAHOADON, MATHIETBI, TIENGIAMGIA FROM CHITIETHD
	FOR UPDATE OF TIENGIAMGIA
	OPEN Cur_TinhGiamGia_CTHD
	DECLARE @MAHD VARCHAR(10), @MATB VARCHAR(10), @TIENGG FLOAT
	FETCH NEXT FROM Cur_TinhGiamGia_CTHD INTO @MAHD, @MATB, @TIENGG
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @TIENGG = (SELECT DONGIA * SOLUONG*PHANTRAMGIAMGIA FROM CHITIETHD WHERE @MAHD = MAHOADON and @MATB = MATHIETBI)
		UPDATE CHITIETHD
		SET TIENGIAMGIA = @TIENGG
		WHERE @MAHD = MAHOADON AND @MATB = MATHIETBI
		FETCH NEXT FROM Cur_TinhGiamGia_CTHD INTO @MAHD, @MATB, @TIENGG
	END
	CLOSE Cur_TinhGiamGia_CTHD
	DEALLOCATE Cur_TinhGiamGia_CTHD
	GO

---7. Viết cursor tính thành tiền của bảng CHITIETHD
	DECLARE Cur_TinhThanhTien_CTHD CURSOR
	FOR SELECT MAHOADON, MATHIETBI, TONGTHANHTIEN FROM CHITIETHD
	FOR UPDATE OF TONGTHANHTIEN
	OPEN Cur_TinhThanhTien_CTHD
	DECLARE @MAHD VARCHAR(10), @MATB VARCHAR(10), @THANHTIEN FLOAT
	FETCH NEXT FROM Cur_TinhThanhTien_CTHD INTO @MAHD, @MATB, @THANHTIEN
	WHILE(@@FETCH_STATUS=0)
	BEGIN
		SET @THANHTIEN = (SELECT (DONGIA * SOLUONG)-(DONGIA * SOLUONG* PHANTRAMGIAMGIA) FROM CHITIETHD WHERE @MAHD = MAHOADON and @MATB = MATHIETBI)
		UPDATE CHITIETHD
		SET TONGTHANHTIEN = @THANHTIEN
		WHERE @MAHD = MAHOADON AND @MATB = MATHIETBI
		FETCH NEXT FROM Cur_TinhThanhTien_CTHD INTO @MAHD, @MATB, @THANHTIEN
	END
	CLOSE Cur_TinhThanhTien_CTHD
	DEALLOCATE Cur_TinhThanhTien_CTHD
	GO

/*-------------------------------- SAO LƯU DỮ LIỆU (BACKUP) -----------------------------*/
--- LOẠI 1: Chúng ta thực hiện FULLBACKUP toàn bộ dữ liệu
	DECLARE @fileName varchar(100);
	DECLARE @dbName varchar(100);
	DECLARE @fileDate varchar(20);

	SET @fileName = 'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\BACKUP\';
	SET @dbName = 'DB_LINHKIENMAYTINH';
	SET @fileDate = CONVERT(varchar(20), GETDATE(), 112);

	SET @fileName = @fileName + @dbName + '-' + @fileDate + '.bak';

	BACKUP DATABASE @dbName to Disk = @fileName;

--- LOẠI 2: Chúng ta thực hiện DIFFERENTIAL BACKUP  sẽ sao lưu phần thay đổi so với ngày FULLBACKUP gần nhất 
	BACKUP DATABASE DB_LINHKIENMAYTINH
	TO DISK = 'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\BACKUP\DIFFER_BACKUP.bak' 
	WITH DIFFERENTIAL
	GO

--- LOẠI 3: Sau khi có sự thay đổi dữ liệu LOGBACKUP sẽ tiến hành backup dữ liệu ngay (phút, giờ hoặc ngày,...)
	BACKUP LOG DB_LINHKIENMAYTINH
	TO DISK = 'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\BACKUP\TEST_LOG.trn'
	WITH INIT
	GO
/*THỰC HIỆN SO SÁNH TỐC ĐỘ LƯU TRỮ CỦA 3 LOẠI BACKUP TỪ CHẬM NHẤT ĐẾN NHANH NHẤT: FULLBACKUP, DIFFERENTIAL BACKUP, LOG BACKUP*/	

						
/*-------------------------------- PHỤC HỒI DỮ LIỆU (RESTORE) -----------------------------*/
--- LOẠI 1: Chúng ta thực hiện RESTORE từ FULLBACKUP
	RESTORE DATABASE DB_LINHKIENMAYTINH 
	FROM DISK = 'C:\Users\Admin\Desktop\DB_LINHKIENMAYTINH-20210828.bak' 
	WITH RECOVERY
	GO

--- LOẠI 2: Chúng ta thực hiện RESTORE từ DIFFERENTIAL BACKUP 
	RESTORE DATABASE DB_LINHKIENMAYTINH
	FROM DISK = 'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\BACKUP\DIFFER_BACKUP.bak' 
	WITH RECOVERY
	GO

--- LOẠI 3: Chúng ta thực hiện RESTORE từ LOGBACKUP
	RESTORE DATABASE DB_LINHKIENMAYTINH
	FROM DISK = 'C:\Users\Admin\Documents\Học kì 4\HQT CSDL\BACKUP\TEST_LOG.trn'
	WITH RECOVERY
	GO

/*-------------------------------- QUẢN TRỊ NGƯỜI DÙNG VÀ BẢO MẬT -----------------------------*/
--Tạo tài khoản đăng nhập

--1. Tạo nhóm Chủ cửa hàng
-- User name  ||   Password
   /*adminTan ||    123abc*/
	sp_addlogin 'adminTan', '123abc'
	Go
   /*adminDuy ||    456abc*/
	sp_addlogin 'adminDuy', '456abc'
	Go
--2. Tạo nhóm Quản lý bán hàng
-----User name  ||   Password
	/*qlbh_Huy  ||    bhHuy*/
	sp_addlogin 'qlbh_Huy', 'bhHuy'
	Go
	/*qlbh_Dung ||    bhDung*/
	sp_addlogin 'qlbh_Dung', 'bhDung'
	Go
--3. Tạo nhóm Quản lý nhân sự
-----User name  ||   Password
	/*qlns_Nam  ||    nsNam*/
	sp_addlogin 'qlns_Nam', 'nsNam'
	Go
	/*qlns_Ngoc ||    nsNgoc*/
	sp_addlogin 'qlns_Ngoc', 'nsNgoc'
	Go
--PHÂN QUYỀN
---1. Nhóm Chủ cửa hàng được phép toàn quyền
	SP_ADDROLEMEMBER 'db_owner', 'adminTan'
	GO
	SP_ADDROLEMEMBER 'db_owner', 'adminDuy'
	GO
	GRANT SELECT, INSERT, UPDATE, DELETE
	TO adminTan, adminDuy
	WITH GRANT OPTION
	GO
---2. Nhóm Quản lý bán hàng được phép xem, thêm, xóa, sửa các bảng HOADON, CHITIETHD, HOADONNHAP, CHITIETNHAPHANG
	GRANT SELECT, INSERT, UPDATE, DELETE
	ON HOADON
	TO qlbh_Huy, qlbh_Dung 
	WITH GRANT OPTION
	GO
	GRANT SELECT, INSERT, UPDATE, DELETE
	ON CHITIETHD
	TO qlbh_Huy, qlbh_Dung
	WITH GRANT OPTION
	GO
	GRANT SELECT, INSERT, UPDATE, DELETE
	ON HOADONNHAP
	TO qlbh_Huy, qlbh_Dung
	WITH GRANT OPTION
	GO
	GRANT SELECT, INSERT, UPDATE, DELETE
	ON CHITIETNHAPHANG
	TO qlbh_Huy, qlbh_Dung
	WITH GRANT OPTION
	GO
---3. Nhóm Quản lý nhân sự được phép xem, thêm, xóa, sửa các bảng NHANVIEN, KHACHHANG
	GRANT SELECT, INSERT, UPDATE, DELETE
	ON NHANVIEN
	TO qlns_Nam, qlns_Ngoc
	WITH GRANT OPTION
	GO
	GRANT SELECT, INSERT, UPDATE, DELETE
	ON KHACHHANG
	TO qlns_Nam, qlns_Ngoc
	WITH GRANT OPTION
	GO